# File Uploads

> If a web application has this type of vulnerability, an aggressor can upload a file with malicious code in it that can be executed on the server.

## No Filters

Try to upload a php, aspx, jsp.. with a reverse/web shell and see if the application performs any checks.

_____

## Content-Type filter

When uploading a file, the browser automatically sets a Content-Type (inside the multipart/form-data) field in the request. If the checks are performed only using the Content-Type, we can bypass it by changing it with Burp.

_____

## Backlists

Some filters use a blacklist to not allow to upload, for example, .php applications. The system can be vulnerable and we can bypass the filter changing the extensions to:

```bash
.pHP, .PHP, .PHp, PhP..
```

If the file is uploaded but then we can not execute it, we can try to upload and override the .htacces to allow execution. The contents of the new .htaccess would be:

```bash
#Change $extension with .PHp, .PHP..
AddType application/x-httpd-php $extension
```

Also, the blacklist can be bypassed by uploading a language-supported extension which comes enabled by default (these doesn't requiere to add a new .htaccess):

```bash
.php5, .php4, .php3...
```

______

## Whitelists

Imagine only .gif images are allowed. In apache servers, files can have more than one extension, and the order of the extensions is normally irrelevant (if the mime type is different). If the mime is the same, only the extension at the right will be processed

```bash
.php.gif
```

This vulnerability is patched on new Apache versions, but still vulnerable on old systems. Also there are some times where the file uploaded have an extra check (GetImagesize()). We can bypass this by appending a PHP comment to our .gif:

```bash
gisicle --comment <?php $WEBSHELL_CODE_ONELINER ?> < $file.gif > $file.php.gif
```

To make the webshells to oneliner:

```bash
tr '\n' ' ' < webshell.php
```

_____

## NullByte attack

Generate a file with double extension (.php.gif) and add the webshell inside the image (using gisicle). Then, grab the request with burp and change the name of the file to file.php(nullbyte).gif. This can be done with burp HEX view.






